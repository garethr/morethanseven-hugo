<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.18" />
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>More than seven &middot; More than seven</title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/hyde.css">
  <link rel="stylesheet" href="/css/poole-overrides.css">
  <link rel="stylesheet" href="/css/hyde-overrides.css">
  <link rel="stylesheet" href="/css/hyde-x.css">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link href="/favicon.png" rel="icon">

  
  
  
  <link href="/index.xml" rel="alternate" type="application/rss+xml" title="More than seven &middot; More than seven" />

  <meta name="description" content="">
  <meta name="keywords" content="">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-435455-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body class="theme-base-08">
<div class="sidebar">
  <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?zoneid=1673&serve=C6AILKT&placement=morethansevennet" id="_carbonads_js"></script>
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1><a href="/">More than seven</a></h1>
      <p class="lead">Writing about code. Occasional other topics. Made by <a href="https://twitter.com/garethr">@garethr</a>.</p>
    </div>
  </div>
</div>


<div class="content container">
  <div class="posts">
    
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2009/09/21/learnings-september/">Learnings from September</a>
      </h1>
      <span class="post-date">Sep 21, 2009 &middot; 2 minute read
      </span>
      
      <p>I&rsquo;m keep meaning to get around to writing about why I think the future of web developers is operations but in lieu of a proper post here&rsquo;s a list of things I&rsquo;ve been spending my work life getting to know this month:</p>

<ul>
<li><a href="http://reductivelabs.com/products/puppet">Puppet</a> - It&rsquo;s brilliant. Define (with a Ruby DSL of course) what software and services you want running on all your machines, install a daemon on each of them, and hey presto central configuration management.</li>
<li><a href="http://www.vmware.com/products/vsphere/">VMWare vsphere</a> - puppet makes more sense the more boxes you have. With vsphere I can have as many boxes as I want (nearly). Command line scripts and an actually very nice windows gui for settings up virtual machines is all pretty nice, especially running on some meaty hardware.</li>
<li><a href="http://nagios.org/">Nagios</a> - With lots of boxes comes lots of responsibility (or something). Nagios might look a bit ugly, and bug me with it&rsquo;s needless frames based admin, but I can see what people see in it. Which frankly is the ability to monitor everything everywhere for any change what-so-ever.</li>
<li><a href="http://lucene.apache.org/solr/">Solr</a> - I&rsquo;m now also pretty well versed in using Solr. I&rsquo;ve used it in the past, but always behind a Ruby or Python library. Now I know my way around all the XML based configuration inards. Heck, I&rsquo;m even running a nighly release from a couple of days ago in a production environment because I wanted a cool new feature. A special mention to the Solr community on the mailing list, twitter and irc for being great when I had questions.</li>
<li>Solaris - I nearly forgot, I spend more time than I care to remember working out how to use Open Solaris (conclusion: OK, but not Debian) and eventually Solaris 10 (conclusion: hope I don&rsquo;t have to do that again). My installation notes read like some hideous hack but everything works fine in production and it&rsquo;s scarily repeatable so I&rsquo;ll live with it for now.</li>
</ul>

<p>I do wonder if it&rsquo;s just me that&rsquo;s drawn to knowing how everything in the full web stack works. But personally I can&rsquo;t just write code if I don&rsquo;t understand how to deploy it or what it&rsquo;s running on. Front end types know this all too well. Being a master of CSS, HTML and Javascript simply isn&rsquo;t enough. You need to understand the browser to get anything done. I&rsquo;m not sure it&rsquo;s the same for all backend inclined folk; how many PHP programmers really understand Apache and a few other useful bits of web tech?</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2009/09/13/no-database-test-runner-added-test-extensions/">No database test runner added to test extensions</a>
      </h1>
      <span class="post-date">Sep 13, 2009 &middot; 1 minute read
      </span>
      
      <p>Thanks to <a href="http://intranation.com/">Brad</a> I&rsquo;ve just released a new version of <a href="http://pypi.python.org/pypi/django-test-extensions/0.5">Django Test Extensions</a> (also on <a href="http://github.com/garethr/django-test-extensions">GitHub</a> with support for running tests without the overhead of setting up and tearing down the database. Django still has a few places were it assumes you&rsquo;ll have a database somewhere in your project - and the default test runner is one of them.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2009/09/06/automating-web-site-deployment-barcamp-brighton/">Automating web site deployment at Barcamp Brighton</a>
      </h1>
      <span class="post-date">Sep 6, 2009 &middot; 1 minute read
      </span>
      
      <p>On the first day at Barcamp Brighton this year I did a brief talk about getting started with automating deployment. I kept it nice and simple and didn&rsquo;t focus on any specific technology or tool - just the general principles and pitfalls of doing anything manually. You can see the &ldquo;slides on Slideshare&rdquo;:</p>

<p><object style="margin:0px" width="425" height="355">
<param name="movie" value="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=automatingdeployment-090906054723-phpapp01&stripped_title=automating-web-site-deployment" /><param name="allowFullScreen" value="true"/><param name="allowScriptAccess" value="always"/><embed src="http://static.slidesharecdn.com/swf/ssplayer2.swf?doc=automatingdeployment-090906054723-phpapp01&stripped_title=automating-web-site-deployment" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="355"></embed></object></p>

<p>As part of the presentation I even did a live demo and promised I&rsquo;d upload the code I used. The following is an incredibly simple fabric file that has most the basic set of tasks. <a href="http://pypi.python.org/pypi/Fabric/">Fabric</a> is a python tool similar to capistrano in Ruby. I don&rsquo;t really care whether you&rsquo;re using make, ant, rake, capistrano or just plain shell scripts. Getting from not automating things to automating deployments is the important part - and it&rsquo;s easier that you think.</p>

<p><script src="http://gist.github.com/181755.js">
</script>
The other part of the code example was a very basic apache virtualhost so just in case anyone needed that as well here it is:</p>

<pre><code>&amp;lt;VirtualHost *:80&amp;gt;
    ServerName sample.local
    DocumentRoot /srv/sample/releases/current
    &amp;lt;Directory /srv/sample/releases/current&amp;gt;
        Order deny,allow
        Allow from all
    &amp;lt;/Directory&amp;gt;
    ErrorLog /var/log/apache2/sample/error.log
    LogLevel warn
    CustomLog /var/log/apache2/sample/access.log combined
&amp;lt;/VirtualHost&amp;gt;
</code></pre>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2009/08/31/another-chance-djugl/">Another chance to DJUGL</a>
      </h1>
      <span class="post-date">Aug 31, 2009 &middot; 2 minute read
      </span>
      
      <p><a href="http://djugl.eventwax.com/djugllondon-python">DJUGL</a> is back, the <em>monthly</em> Django meetup in London. I think the last few times have been as much about useful Python stuff as just using Django, and this time it&rsquo;s officially a bit more broad ranging. If you&rsquo;re in or around London on the 24th September then come along.</p>

<p>You can get more information on <a href="http://twitter.com/londonpython">Twitter</a> or by following <a href="http://twitter.com/robertlofthouse/">Rob</a>. But expect a few short talks, some interesting conversations and maybe some beer with other like minded developers.</p>

<p>I&rsquo;m going to be talking about automating deployment of Python web applications. If you follow me on Twitter you&rsquo;ll have heard me rambling a little about some of what I&rsquo;ve been up to, and some of the posts here give an insight into what I&rsquo;ve been working on. But the short version is that several friends mentioned how difficult it could be to get a working Django application from a local machine to a production web server. And I though I better get down in script form my experiences of Django, WSGI applications and web server setup to make things easier.</p>

<p>I think this situation is partially caused by the success of the Django development server, and partially by people coming from a PHP background. In my PHP days I think I always wanted to know how Apache did it&rsquo;s think, so long ago jumped into anything and everything in httpd.conf from loading modules to virtual hosts. But not everyone does the same, and PHP does make simple deployments easy enough that you might get away without doing so. Rails went through the same problems and seems to be coming out the other side. I&rsquo;m hoping that Django and Python is soon to be in the same position, where basic deployment is just a given.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2009/08/21/django-wsgi-deployment-solaris/">Django and WSGI deployment on Solaris</a>
      </h1>
      <span class="post-date">Aug 21, 2009 &middot; 3 minute read
      </span>
      
      <p>Now I&rsquo;m generally an Ubuntu guy, but I&rsquo;ve just had the need to setup some boxes running Solaris for Django and a handful of WSGI applications. I know my way around Ubuntu pretty well. I know all the packages I need to install and in what order. Hell, I even have all that scripted so I can just run a command and it works by magic. I&rsquo;ll script the following steps if I can do when I get round to it but here, in one list, are the installation instructions for Apache, mod_wsgi, Mysql, MySQLdb, setuptools and memcached that worked for me on the latest version of <a href="http://www.opensolaris.com/">Open Solaris</a> (2009.06 at the time of writing).</p>

<p>First up I needed to install Apache and start the service running.</p>

<pre><code>pfexec pkg install SUNWapch22
svcadm enable http:apache22
</code></pre>

<p>You should be able to test that&rsquo;s running by hitting localhost on a browser running on the same box. Now for MySQL.</p>

<pre><code>pfexec pkg install SUNWmysql5
svcadm enable mysql:version_50
</code></pre>

<p>This installs the mysql binary into /usr/mysql/5.0/bin/mysql on the system I&rsquo;m working on. As I want to talk to the MySQL database server using Python I need to install MySQLdb.</p>

<pre><code>pfexec pkg install SUNWmysql-python
ln -s /usr/mysql/5.0/lib/mysql/libmysqlclient_r.so.15 /usr/lib/libmysqlclient_r.so.15
</code></pre>

<p>This installs the library files into /usr/mysql/5.0/lib and Python doesn&rsquo;t know were to find them. The above command links them into the more standard /usr/lib folder were Python will pick it up nicely.</p>

<p>I tend to use <a href="http://code.google.com/p/modwsgi/">mod_wsgi</a> for serving Python apps behind Apache, however a mod_wsgi package isn&rsquo;t part of the default package list. It is however available in the pending list so first you need to add that list of packages.</p>

<pre><code>pfexec pkg set-authority -O http://pkg.opensolaris.org/pending pending
pfexec pkg refresh
pfexec pkg install mod-wsgi
</code></pre>

<p>This installs the module but you then need to tell Apache to load it. Add the following line to /etc/apache2/2.2/conf.d/modules-32.load or /etc/apache2/2.2/conf.d/modules-64.load depending on your architecture.</p>

<pre><code>LoadModule wsgi_module    libexec/mod_wsgi.so
</code></pre>

<p>To get Apache to load that module you need to restart it like so:</p>

<pre><code>svcadm restart http:apache22
</code></pre>

<p>I use <a href="http://pypi.python.org/pypi/pip">Pip</a> for installing Python code, but tend to install setuptools to make installing Pip easier. I don&rsquo;t know if an up to date Pip package exists.</p>

<pre><code>pfexec pkg install python-setuptools
</code></pre>

<p>This should leave you with easy_install on your path so installing Pip, then virtualenv should be a breeze.</p>

<p>As an added bonus I also installed memcached for some snappy caching.</p>

<pre><code>pfexec pkg install SUNWmemcached
</code></pre>

<p>This won&rsquo;t start up by default and needs a little configuration. The first command will launch you into a prompt where you can type the rest of the commands.</p>

<pre><code>svccfg
svc:&gt; select memcached
svc:/application/database/memcached&gt; setprop memcached/options=(&quot;-u&quot; &quot;nobody&quot;)
svc:/application/database/memcached&gt; quit
</code></pre>

<p>Once you&rsquo;d done that you should be able to start memcache on the standard port.</p>

<pre><code>svcadm refresh memcached
svcadm enable memcached
</code></pre>

<p>Et voila. The internet helped massively on my quest to track down this information. Not all of the following links turned out to work for me but all of them led me in the right direction. Thanks everyone.</p>

<ul>
<li><a href="http://blogs.sun.com/quenelle/entry/jazz_guitar_and_rpath">http://blogs.sun.com/quenelle/entry/jazz_guitar_and_rpath</a></li>
<li><a href="http://blogs.sun.com/natarajan/entry/installing_amp_stack_within_glassfish">http://blogs.sun.com/natarajan/entry/installing_amp_stack_within_glassfish</a></li>
<li><a href="http://blogs.sun.com/overstre/entry/django_on_solaris10_with_the">http://blogs.sun.com/overstre/entry/django_on_solaris10_with_the</a></li>
<li><a href="https://cds.sun.com/is-bin/INTERSHOP.enfinity/WFS/CDS-CDS_SMI-Site/en_US/-/USD/ViewProductDetail-Start?ProductRef=Web-Stack-1.5-OTH-G-F@CDS-CDS_SMI">https://cds.sun.com/is-bin/INTERSHOP.enfinity/WFS/CDS-CDS_SMI-Site/en_US/-/USD/ViewProductDetail-Start?ProductRef=Web-Stack-1.5-OTH-G-F@CDS-CDS_SMI</a></li>
<li><a href="http://wiki.joyent.com/mod_wsgi">http://wiki.joyent.com/mod_wsgi</a></li>
<li><a href="http://textusers.com/wiki/AcceleratorDjango">http://textusers.com/wiki/AcceleratorDjango</a></li>
<li><a href="http://wiki.joyent.com/accelerators:kb:django">http://wiki.joyent.com/accelerators:kb:django</a></li>
<li><a href="http://www.b-list.org/weblog/2007/sep/04/django-accelerated/">http://www.b-list.org/weblog/2007/sep/04/django-accelerated/</a></li>
<li><a href="http://blogs.sun.com/natarajan/entry/getting_ruby_or_amp_apache">http://blogs.sun.com/natarajan/entry/getting_ruby_or_amp_apache</a></li>
<li><a href="http://blogs.sun.com/overstre/entry/opensolaris_with_mod_wsgi">http://blogs.sun.com/overstre/entry/opensolaris_with_mod_wsgi</a></li>
<li><a href="http://branesks.blogspot.com/2009/01/installing-modwsgi-on-opensolaris.html">http://branesks.blogspot.com/2009/01/installing-modwsgi-on-opensolaris.html</a></li>
<li><a href="http://blogs.sun.com/overstre/entry/django_on_opensolaris">http://blogs.sun.com/overstre/entry/django_on_opensolaris</a></li>
<li><a href="http://code.google.com/p/modwsgi/wiki/InstallationOnSolaris">http://code.google.com/p/modwsgi/wiki/InstallationOnSolaris</a></li>
<li><a href="http://groups.google.com/group/modwsgi/browse_thread/thread/7e2cc7ce366253cc">http://groups.google.com/group/modwsgi/browse_thread/thread/7e2cc7ce366253cc</a></li>
<li><a href="http://blogs.sun.com/lr/entry/django_setup_mysql_python_opensolaris">http://blogs.sun.com/lr/entry/django_setup_mysql_python_opensolaris</a></li>
<li><a href="http://blogs.sun.com/trond/entry/memcached_in_solaris">http://blogs.sun.com/trond/entry/memcached_in_solaris</a></li>
<li><a href="http://blog.hendrikvolkmer.de/2009/1/29/deploying-a-rails-application-on-opensolaris-with-passenger-aka-modrails/">http://blog.hendrikvolkmer.de/2009/1/29/deploying-a-rails-application-on-opensolaris-with-passenger-aka-modrails/</a></li>
</ul>

<p>I&rsquo;m not a Solaris admin. I&rsquo;m not really a sysadmin at all, I just end up pretending to be one of late. Any experienced Solaris people with experience of these tools reading this I&rsquo;d be grateful for any hints and tips. Hopefully this saves a few people from the head scratching I&rsquo;ve been doing for the last few days.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2009/08/15/your-own-pypi-server/">Your Own PyPi server</a>
      </h1>
      <span class="post-date">Aug 15, 2009 &middot; 2 minute read
      </span>
      
      <p>So one of the problems with using pip or easy_install as part of an automated deployment process is they rely on an internet connection. More than that, they rely on PyPi being up as it&rsquo;s a centralised system, unlike all the apt package mirrors.</p>

<p>The best solution seems to be to host your own PyPi compliant server. Not only can you load all the third party modules you use onto it, but you could also upload any internal applications or libraries that you like. By running this on your local network you ensure your not dependent on pypi or an internet connection.</p>

<p>At the moment I&rsquo;m playing with <a href="http://github.com/ask/chishop/tree/master">Chishop</a> which is a django application for maintaining a PyPi compatible server. Another alternative if that doesn&rsquo;t work out is <a href="http://pypi.python.org/pypi/EggBasket/">EggBasket</a></p>

<p>To install from your own PyPi server you can specify the location of your Chishop instance with the -i flag.</p>

<p>pre. easy_install -i <a href="http://localhost:8000/">http://localhost:8000/</a> PACKAGE_NAME</p>

<p>This will fall back to the PyPi server if it doesn&rsquo;t find the relevant package. If you want to stop that behaviour and make sure you have a local package then you can limit the hosts with the -H flag like so.</p>

<p>pre. easy_install -H localhost:8000 -i http::/localhost:8000/ PACKAGE_NAME</p>

<p>I&rsquo;m not yet sure how to do this with pip, if someone wants to enlighten me in the comments then I&rsquo;d be most grateful.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2009/07/27/fabric-django-git-apache-mod-wsgi-virtualenv-and-p/">Fabric, Django, Git, Apache, mod_wsgi, virtualenv and pip deployment</a>
      </h1>
      <span class="post-date">Jul 27, 2009 &middot; 6 minute read
      </span>
      
      <p>I&rsquo;ve been playing with automating Django deployments again, this time using <a href="http://fabfile.org/">Fabric</a>. I found a number of examples on the web but non of them quite fit the bill for me. I don&rsquo;t like serving directly from a repository, I like to have either a package or tar I can use to say &ldquo;that is what went to the server&rdquo;. I also like having a quick rollback command as well as being able to deploy a particular version of the code when the need arises. I also wanted to go from a clean ubuntu install (plus SSH) to a running Django application in one command from the local development machine. The Apache side of things is nicely documented in <a href="http://gist.github.com/106077">this Gist</a> which made a good starting point.</p>

<p>I&rsquo;m still missing a few things in this setup mind and at the moment you still have to setup your local machine yourself. I&rsquo;m probably going to create a paster template and another fabfile to do that I think. The instructions are a little rough as well at the moment and I&rsquo;ve left the database out of it as everyone has there own preference.</p>

<p>This particular fabric file makes setting up and deploying a django application much easier, but it does make a few assumptions. Namely that you&rsquo;re using Git, Apache and mod_wsgi and your using Debian or Ubuntu. Also you should have Django installed on your local machine and SSH installed on both the local machine and any servers you want to deploy to.</p>

<p><em>note that I&rsquo;ve used the name project_name throughout this example. Replace this with whatever your project is called.</em></p>

<p>First step is to create your project locally:</p>

<p>pre. mkdir project_name
cd project_name
django-admin.py startproject project_name</p>

<p>Now add a requirements file so pip knows to install Django. You&rsquo;ll probably add other required modules in here later. Creat a file called requirements.txt and save it at the top level with the following contents:</p>

<p>pre. Django</p>

<p>Then save this fabfile.py file in the top level directory which should give you:</p>

<p>pre. project_name
fabfile.py
requirements.txt
project_name
<em>init</em>.py
manage.py
settings.py
urls.py</p>

<p>You&rsquo;ll need a WSGI file called project_name.wsgi, where project_name is the name you gave to your django project. It will probably look like the following, depending on your specific paths and the location of your settings module</p>

<p>pre. import os
import sys</p>

<ol>
<li>put the Django project on sys.path
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(<em>file</em>), &ldquo;../&rdquo;)))
os.environ[&ldquo;DJANGO_SETTINGS_MODULE&rdquo;] = &ldquo;project_name.settings&rdquo;
from django.core.handlers.wsgi import WSGIHandler
application = WSGIHandler()</li>
</ol>

<p>Last but not least you&rsquo;ll want a virtualhost file for apache which looks something like the following. Save this as project_name in the inner directory. You&rsquo;ll want to change /path/to/project_name/ to the location on the remote server you intent to deploy to.</p>

<p>pre. <VirtualHost *:80>
WSGIDaemonProcess project_name-production user=project_name group=project_name threads=10 python-path=/path/to/project_name/lib/python2.6/site-packages
WSGIProcessGroup project_name-production
WSGIScriptAlias / /path/to/project_name/releases/current/project_name/project_name.wsgi
<Directory /path/to/project_name/releases/current/project_name>
Order deny,allow
Allow from all
</Directory>
ErrorLog /var/log/apache2/error.log
LogLevel warn
CustomLog /var/log/apache2/access.log combined
</VirtualHost></p>

<p>Now create a file called .gitignore, containing the following. This prevents the compiled python code being included in the repository and the archive we use for deployment.</p>

<p>pre. *.pyc</p>

<p>You should now be ready to initialise a git repository in the top level project_name directory.</p>

<p>pre. git init
git add .gitignore project_name
git commit -m &ldquo;Initial commit&rdquo;</p>

<p>All of that should leave you with</p>

<p>pre. project_name
.git
.gitignore
requirements.txt
fabfile.py
project_name
<em>init</em>.py
project_name
project_name.wsgi
manage.py
settings.py
urls.py</p>

<p>In reality you might prefer to keep your wsgi files and virtual host files elsewhere. The fabfile has a variable (config.virtualhost_path) for this case. You&rsquo;ll also want to set the hosts that you intend to deploy to (config.hosts) as well as the user (config.user).</p>

<p>The first task we&rsquo;re interested in is called setup. It installs all the required software on the remote machine, then deploys your code and restarts the webserver.</p>

<p>pre. fab local setup</p>

<p>After you&rsquo;ve made a few changes and commit them to the master Git branch you can run to deply the changes.</p>

<p>pre. fab local deploy</p>

<p>If something is wrong then you can rollback to the previous version.</p>

<p>pre. fab local rollback</p>

<p>Note that this only allows you to rollback to the release immediately before the latest one. If you want to pick a arbitrary release then you can use the following, where 20090727170527 is a timestamp for an existing release.</p>

<p>pre. fab local deploy_version:20090727170527</p>

<p>If you want to ensure your tests run before you make a deployment then you can do the following.</p>

<p>pre. fab local test deploy</p>

<p>The actual fabfile looks like this. I&rsquo;ve uploaded a <a href="http://gist.github.com/156623">Gist of it</a>, along with the docs, so if you want to improve it please clone it.</p>

<p>pre. # globals
config.project_name = &lsquo;project_name&rsquo;</p>

<ol>
<li>environments
def local():
&ldquo;Use the local virtual server&rdquo;
config.hosts = [&lsquo;172.16.142.130&rsquo;]
config.path = &lsquo;/path/to/project_name&rsquo;
config.user = &lsquo;garethr&rsquo;
config.virtualhost_path = &ldquo;/&rdquo;</li>
<li>tasks
def test():
&ldquo;Run the test suite and bail out if it fails&rdquo;
local(&ldquo;cd $(project_name); python manage.py test&rdquo;, fail=&ldquo;abort&rdquo;)
def setup():
&ldquo;&rdquo;&rdquo;
Setup a fresh virtualenv as well as a few useful directories, then run
a full deployment
&ldquo;&rdquo;&rdquo;
require(&lsquo;hosts&rsquo;, provided_by=[local])
require(&lsquo;path&rsquo;)
sudo(&lsquo;aptitude install -y python-setuptools&rsquo;)
sudo(&lsquo;easy_install pip&rsquo;)
sudo(&lsquo;pip install virtualenv&rsquo;)
sudo(&lsquo;aptitude install -y apache2&rsquo;)
sudo(&lsquo;aptitude install -y libapache2-mod-wsgi&rsquo;)
# we want rid of the defult apache config
sudo(&lsquo;cd /etc/apache2/sites-available/; a2dissite default;&rsquo;)
run(&lsquo;mkdir -p $(path); cd $(path); virtualenv .;&rsquo;)
run(&lsquo;cd $(path); mkdir releases; mkdir shared; mkdir packages;&rsquo;, fail=&lsquo;ignore&rsquo;)
deploy()
def deploy():
&ldquo;&rdquo;&rdquo;
Deploy the latest version of the site to the servers, install any
required third party modules, install the virtual host and
then restart the webserver
&ldquo;&rdquo;&rdquo;
require(&lsquo;hosts&rsquo;, provided_by=[local])
require(&lsquo;path&rsquo;)
import time
config.release = time.strftime(&lsquo;%Y%m%d%H%M%S&rsquo;)
upload_tar_from_git()
install_requirements()
install_site()
symlink_current_release()
migrate()
restart_webserver()
def deploy_version(version):
&ldquo;Specify a specific version to be made live&rdquo;
require(&lsquo;hosts&rsquo;, provided_by=[local])
require(&lsquo;path&rsquo;)
config.version = version
run(&lsquo;cd $(path); rm releases/previous; mv releases/current releases/previous;&rsquo;)
run(&lsquo;cd $(path); ln -s $(version) releases/current&rsquo;)
restart_webserver()
def rollback():
&ldquo;&rdquo;&rdquo;
Limited rollback capability. Simple loads the previously current
version of the code. Rolling back again will swap between the two.
&ldquo;&rdquo;&rdquo;
require(&lsquo;hosts&rsquo;, provided_by=[local])
require(&lsquo;path&rsquo;)
run(&lsquo;cd $(path); mv releases/current releases/_previous;&lsquo;)
run(&lsquo;cd $(path); mv releases/previous releases/current;&rsquo;)
run(&lsquo;cd $(path); mv releases/_previous releases/previous;&lsquo;)
restart_webserver()</li>
<li>Helpers. These are called by other functions rather than directly
def upload_tar_from_git():
require(&lsquo;release&rsquo;, provided_by=[deploy, setup])
&ldquo;Create an archive from the current Git master branch and upload it&rdquo;
local(&lsquo;git archive &ndash;format=tar master | gzip &gt; $(release).tar.gz&rsquo;)
run(&lsquo;mkdir $(path)/releases/$(release)&rsquo;)
put(&lsquo;$(release).tar.gz&rsquo;, &lsquo;$(path)/packages/&rsquo;)
run(&lsquo;cd $(path)/releases/$(release) &amp;&amp; tar zxf ../../packages/$(release).tar.gz&rsquo;)
local(&lsquo;rm $(release).tar.gz&rsquo;)
def install_site():
&ldquo;Add the virtualhost file to apache&rdquo;
require(&lsquo;release&rsquo;, provided_by=[deploy, setup])
sudo(&lsquo;cd $(path)/releases/$(release); cp $(project_name)$(virtualhost_path)$(project_name) /etc/apache2/sites-available/&lsquo;)
sudo(&lsquo;cd /etc/apache2/sites-available/; a2ensite $(project_name)&lsquo;)
def install_requirements():
&ldquo;Install the required packages from the requirements file using pip&rdquo;
require(&lsquo;release&rsquo;, provided_by=[deploy, setup])
run(&lsquo;cd $(path); pip install -E . -r ./releases/$(release)/requirements.txt&rsquo;)
def symlink_current_release():
&ldquo;Symlink our current release&rdquo;
require(&lsquo;release&rsquo;, provided_by=[deploy, setup])
run(&lsquo;cd $(path); rm releases/previous; mv releases/current releases/previous;&rsquo;, fail=&lsquo;ignore&rsquo;)
run(&lsquo;cd $(path); ln -s $(release) releases/current&rsquo;)
def migrate():
&ldquo;Update the database&rdquo;
require(&lsquo;project_name&rsquo;)
run(&lsquo;cd $(path)/releases/current/$(project_name); ../../../bin/python manage.py syncdb &ndash;noinput&rsquo;)
def restart_webserver():
&ldquo;Restart the web server&rdquo;
sudo(&lsquo;/etc/init.d/apache2 restart&rsquo;)</li>
</ol>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2009/07/23/whats-new-django-11/">What&#39;s new in Django 1.1</a>
      </h1>
      <span class="post-date">Jul 23, 2009 &middot; 3 minute read
      </span>
      
      

<p>With the <a href="http://www.djangoproject.com/weblog/2009/jul/21/rc/">release candidate for Django 1.1</a> out the door I decided to have a quick look at what&rsquo;s new. This isn&rsquo;t a complete list, rather the bits I found most interesting.</p>

<h2 id="conditional-views-http-docs-djangoproject-com-en-dev-topics-conditional-view-processing"><a href="http://docs.djangoproject.com/en/dev/topics/conditional-view-processing/">Conditional Views</a></h2>

<blockquote>
<p>Django now has much better support for conditional view processing using the standard ETag and Last-Modified HTTP headers. This means you can now easily short-circuit view processing by testing less-expensive conditions. For many views this can lead to a serious improvement in speed and reduction in bandwidth.</p>
</blockquote>

<p>A nice set of decorators for dealing with ETags and Last-Modified headers. Again very simple to use and set up, and a simple way of squeezing a little more performance out of you application.</p>

<h2 id="admin-actions-http-docs-djangoproject-com-en-dev-ref-contrib-admin-actions-ref-contrib-admin-actions"><a href="http://docs.djangoproject.com/en/dev/ref/contrib/admin/actions/#ref-contrib-admin-actions">Admin Actions</a></h2>

<blockquote>
<p>The basic workflow of Django’s admin is, in a nutshell, “select an object, then change it.” This works well for a majority of use cases. However, if you need to make the same change to many objects at once, this workflow can be quite tedious. In these cases, Django’s admin lets you write and register “actions” – simple functions that get called with a list of objects selected on the change list page.</p>
</blockquote>

<p>Anything that makes the admin a little more powerful and a little more flexible is a good idea in my book. Admin actions allow you to run code over multiple objects at once, simple select them with a checkbox then select an action to run. This is worth it for the delete action alone, but you can write your own actions simply enough as well (for instance for approving a batch of comments, or archiving a set or articles.)</p>

<h2 id="editable-admin-list-items-http-docs-djangoproject-com-en-dev-ref-contrib-admin-admin-list-editable"><a href="http://docs.djangoproject.com/en/dev/ref/contrib/admin/#admin-list-editable">Editable Admin List Items</a></h2>

<blockquote>
<p>You can now make fields editable on the admin list views via the new list_editable admin option. These fields will show up as form widgets on the list pages, and can be edited and saved in bulk.</p>
</blockquote>

<p>Another time saving admin addition, this time for making some fields editable from the change list rather than the object view. For quick changes, especially to boolean fields, I think this again is a nice addition.</p>

<h2 id="unmanaged-models-http-docs-djangoproject-com-en-dev-ref-models-options-django-db-models-options-managed"><a href="http://docs.djangoproject.com/en/dev/ref/models/options/#django.db.models.Options.managed">Unmanaged Models</a></h2>

<blockquote>
<p>You can now control whether or not Django creates database tables for a model using the managed model option. This defaults to True, meaning that Django will create the appropriate database tables in syncdb and remove them as part of reset command. That is, Django manages the database table’s lifecycle. If you set this to False, however, no database table creating or deletion will be automatically performed for this model. This is useful if the model represents an existing table or a database view that has been created by some other means.</p>
</blockquote>

<p>I particularly like this addition. One of the issues I had with Django was some of the built in assumptions, in particular that you&rsquo;d be using a SQL database backend. Using unmanaged models looks like a great approach to using an alternative database like couchdb, tokyotyrant or mongodb or representing a webservice interface in your application.</p>

<p>I&rsquo;m sure I&rsquo;ll have missed a few other interesting changes or additions. Anyone else have a favourite?</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2009/07/15/simple-app-running-scripts-and-recording-results/">Asteroid - simple app for running scripts and recording the results</a>
      </h1>
      <span class="post-date">Jul 15, 2009 &middot; 4 minute read
      </span>
      
      

<p>Asteroid is a simple web interface for running scripts and recording the results. It&rsquo;s like a much simpler and more general purpose version of something like Cruise Control. You can <a href="http://github.com/garethr/Asteroid/tree/master">get the code on Github</a>.</p>

<p><img src="http://image-host.appspot.com/i/img?id=agppbWFnZS1ob3N0cgwLEgVJbWFnZRj5VQw" alt="Asteroid Dashboard"/></p>

<p>I built it to solve two main problems:</p>

<ul>
<li>It&rsquo;s sometimes useful to have a historical record of a scripts execution, in particular whether it passed or failed and what the output was. Just running a command line script probably doesn&rsquo;t give you that. It&rsquo;s also useful to have a more graphical interface for those members of the team who don&rsquo;t use the command line.</li>
<li>When working in a team you often want to run scripts against shared infrastructure, for instance deploying a testing release or running a test suite. Seeing what is running at present helps with that.</li>
</ul>

<p>So it should be useful for running deployments, running test suites, running backups, etc. It currently doesn&rsquo;t have scheduling or similar build in, but as everything is triggered by hitting a URL it would be simple enough to use cron for something like that. It should also be useful whatever language you write your scripts in; rake, ant, shell scripts, etc. At the end of the day it just executes a command at the console.</p>

<h2 id="requirements">Requirements</h2>

<p>Asteroid uses the Django Python framework under the hood.</p>

<ul>
<li>Django - <a href="http://www.djangoproject.com/">http://www.djangoproject.com/</a></li>
</ul>

<p>You&rsquo;ll also need a database. The default in the shipped settings is to use sqlite but this should work with any database supported by Django.</p>

<p>You&rsquo;ll also need a decent web browser. I&rsquo;ve gone and used HTML5 as an experiment and with this being a developer tool I&rsquo;m hoping to stick with it. It would be easy enough to convert the templates if this is a problem however.</p>

<p>The application has an optional message queue backend which can be enabled in the settings file. This is used to improve the responsiveness of the application as well as allow commands to be executed on a remote machine, rather than on the box Asteroid is running.</p>

<ul>
<li>AMQPlib - <a href="http://barryp.org/software/py-amqplib/">http://barryp.org/software/py-amqplib/</a></li>
<li>RabbitMQ - <a href="http://www.rabbitmq.com/">http://www.rabbitmq.com/</a></li>
</ul>

<p>Other AMQP compliant message queues should work but it&rsquo;s currently only tested with Rabbit.</p>

<p>If you are intending to do any development on Asteroid, or just want to look more closely at the code, I&rsquo;d recommend installing</p>

<ul>
<li>Clue - <a href="http://github.com/garethr/django-clue/tree/master">http://github.com/garethr/django-clue/tree/master</a></li>
<li>Test Extensions - <a href="http://github.com/garethr/django-test-extensions/tree/master">http://github.com/garethr/django-test-extensions/tree/master</a></li>
</ul>

<h2 id="usage-instructions">Usage Instructions</h2>

<p>You should be able to just download asteroid and run it from wherever you put it, once you setup the database.</p>

<pre><code>cd asteroid/configs/common
manage.py syncdb
manage.py runserver
</code></pre>

<p>This should bring the local web server up on port 8000 so visit <a href="http://localhost:8000">http://localhost:8000</a> and see.</p>

<p>If you&rsquo;re using the message queue backend you&rsquo;ll need to run the listener script in order to get your commands executed. At the moment that means modifying a constant in the listener script to point at a running message queue instance at asteroid/bin/asteroid_listen.py.</p>

<pre><code>cd asteroid/bin
./asteroid_listen.py
</code></pre>

<p>Once you&rsquo;re up and running you should be able to add commands via the admin interface at <a href="http://localhost:8000/admin/">http://localhost:8000/admin/</a>. The username and password should be those you added when creating the database via the syncdb command above.</p>

<p>The development configs include a few additional applications (mentioned above) which I use for testing and debugging. You can run the test suite like so:</p>

<pre><code>cd asteroid/configs/development
manage.py test --coverage
</code></pre>

<h2 id="todo">Todo</h2>

<p>This is an early release that just about <em>works for me</em>. I can already see a number of areas I&rsquo;d like to clean up a little or extend. For instance:</p>

<ul>
<li>Other deployment options, including a WSGI file and a spawning startup script.</li>
<li>Use a database migration system to make upgrades easier.</li>
<li>Make the message queue listener script more robust.</li>
<li>Make the command entry more robust, it sometimes takes a bit of fiddling with to get something to run correctly.</li>
<li>Formalise running scripts on remote machines, including support for running on multiple machines.</li>
<li>Paging for long lists of commands or runs.</li>
</ul>

<h2 id="notes">Notes</h2>

<p>I&rsquo;m pretty happy with how it&rsquo;s shaping up so far. Under the hood it works by having the web app put a JSON document on the message queue. The JSON contains the command to be run and a callback URL. The script listening to the message queue picks up the message, runs the command, and posts a JSON document back to the webhook url. It keeps the web interface snappy, as well as meaning it can show which commands are currently in progress at any given time. It also has the side benefit of meaning you can execute commands on a remote machine, as the listener doesn&rsquo;t care where it&rsquo;s running.</p>

<p>As noted above I have a few ideas of where I want to take it, but I&rsquo;m going to try using it for a bit and see how that goes. If anyone else finds it useful then do let me know.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2009/07/13/its-data-we-want/">It&#39;s the Data we Want</a>
      </h1>
      <span class="post-date">Jul 13, 2009 &middot; 3 minute read
      </span>
      
      <blockquote>
<p>A spreadsheet. A CSV file. Whatever is in use internally. Made available to people like us under a suitable license.</p>
</blockquote>

<p>I feel a little self adsorbed quoting myself (from a recent <a href="http://refreshcambridge.org/">Refresh Cambridge</a> discussion) but I did like the turn of phrase. What I was rambling on about was Cambridge County mapping data, after a question from a nice chap from the council about what <em>&ldquo;new, exciting map technology&rdquo;</em> we&rsquo;d like to see. But it applies to any data that you&rsquo;re trying to make public what-so-ever, be it government or otherwise.</p>

<p>What myself and a few other people were talking about, and one of the things that has been discussed as part of the <a href="http://rewiredstate.org/">Rewired State</a> group, is that it&rsquo;s all about the data, not necessarily about a nice web based API.</p>

<p>Now I&rsquo;ve written and spoken about the need for well designed API&rsquo;s being treated as part of the user interface. But remember interface design, and by association API design, isn&rsquo;t easy. API design is often about building manageable flexibility. A public API is often about managing the flow of data you control out to third parties, as well as the information itself it might include limitations on usage, or request rate, or storage. A public API codifies how that information can be accessed. APIs also have to tread a fine line between making it easy for you to solve your problem, and making it easy for everyone else to solve their completely different problems. These compromises are design.</p>

<p>But not everything needs an API. Sometimes it&rsquo;s just about the data, and the best way of getting at that data is as raw as possible. Government data is an easy sell here, as it is (or rather should be) <em>our</em> data. It&rsquo;s also for the most part interesting to read rather than write (historical council tax data, or population data for instance). Raw data can generally be provided quicker than via an API. It doesn&rsquo;t need fragile computer systems or extensive manual labour. It doesn&rsquo;t need particularly clever computing resources. Just upload a spreadsheet or a CSV file to a sensible URL on a known, regular basis and away we go.</p>

<p>And giving data like this away to the development community is likely to have a few additional benefits if that data is useful (it probably is to someone). We&rsquo;ll happily write software libraries, or create APIs over the top of it for you. We&rsquo;ll also write all sorts of useful tools using the data in ways no one else thought of. So if you&rsquo;re sat on a load of data that&rsquo;s not core to your business, or is meant to be public anyway, then lets start talking publicly about how to just get this out on the web quickly and cheaply, rather than spending lots of your time and money on something fancy.</p>

      
    </div>
    
    
    
    <ul class="pagination">
        
        <li>
            <a href="/" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
        </li>
        
        <li
        >
        <a href="/page/12/" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
        </li>
        
        <li
        ><a href="/">1</a></li>
        
        <li
        ><a href="/page/2/">2</a></li>
        
        <li
        ><a href="/page/3/">3</a></li>
        
        <li
        ><a href="/page/4/">4</a></li>
        
        <li
        ><a href="/page/5/">5</a></li>
        
        <li
        ><a href="/page/6/">6</a></li>
        
        <li
        ><a href="/page/7/">7</a></li>
        
        <li
        ><a href="/page/8/">8</a></li>
        
        <li
        ><a href="/page/9/">9</a></li>
        
        <li
        ><a href="/page/10/">10</a></li>
        
        <li
        ><a href="/page/11/">11</a></li>
        
        <li
        ><a href="/page/12/">12</a></li>
        
        <li
        class="active"><a href="/page/13/">13</a></li>
        
        <li
        ><a href="/page/14/">14</a></li>
        
        <li
        ><a href="/page/15/">15</a></li>
        
        <li
        ><a href="/page/16/">16</a></li>
        
        <li
        ><a href="/page/17/">17</a></li>
        
        <li
        ><a href="/page/18/">18</a></li>
        
        <li
        ><a href="/page/19/">19</a></li>
        
        <li
        ><a href="/page/20/">20</a></li>
        
        <li
        ><a href="/page/21/">21</a></li>
        
        <li
        ><a href="/page/22/">22</a></li>
        
        <li
        ><a href="/page/23/">23</a></li>
        
        <li
        ><a href="/page/24/">24</a></li>
        
        <li
        ><a href="/page/25/">25</a></li>
        
        <li
        ><a href="/page/26/">26</a></li>
        
        <li
        ><a href="/page/27/">27</a></li>
        
        <li
        ><a href="/page/28/">28</a></li>
        
        <li
        ><a href="/page/29/">29</a></li>
        
        <li
        ><a href="/page/30/">30</a></li>
        
        <li
        ><a href="/page/31/">31</a></li>
        
        <li
        ><a href="/page/32/">32</a></li>
        
        <li
        ><a href="/page/33/">33</a></li>
        
        <li
        ><a href="/page/34/">34</a></li>
        
        <li
        ><a href="/page/35/">35</a></li>
        
        <li
        ><a href="/page/36/">36</a></li>
        
        <li
        ><a href="/page/37/">37</a></li>
        
        <li
        ><a href="/page/38/">38</a></li>
        
        <li
        ><a href="/page/39/">39</a></li>
        
        <li
        ><a href="/page/40/">40</a></li>
        
        <li
        ><a href="/page/41/">41</a></li>
        
        <li
        ><a href="/page/42/">42</a></li>
        
        <li
        >
        <a href="/page/14/" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
        </li>
        
        <li>
            <a href="/page/42/" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
        </li>
        
    </ul>
    
  </div>
</div>



</body>
</html>

