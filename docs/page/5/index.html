<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
	<meta name="generator" content="Hugo 0.37" />
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>More than seven &middot; More than seven</title>

  
  <link rel="stylesheet" href="/css/poole.css">
  <link rel="stylesheet" href="/css/hyde.css">
  <link rel="stylesheet" href="/css/poole-overrides.css">
  <link rel="stylesheet" href="/css/hyde-overrides.css">
  <link rel="stylesheet" href="/css/hyde-x.css">
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
  

  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/touch-icon-144-precomposed.png">
  <link href="/favicon.png" rel="icon">

  
  
  
  <link href="/index.xml" rel="alternate" type="application/rss+xml" title="More than seven &middot; More than seven" />

  <meta name="description" content="">
  <meta name="keywords" content="">
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-435455-1', 'auto');
    ga('send', 'pageview');
  </script>
  
</head>
<body class="theme-base-08">
<div class="sidebar">
  <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CKYIKK3M&placement=morethansevennet" id="_carbonads_js"></script>
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      
      <h1><a href="/">More than seven</a></h1>
      <p class="lead">Writing about code. Occasional other topics. Made by <a href="https://twitter.com/garethr">@garethr</a>.</p>
    </div>
  </div>
</div>


<div class="content container">
  <div class="posts">
    
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2013/03/23/perils-of-portability/">Perils of portability</a>
      </h1>
      <span class="post-date">Mar 23, 2013 &middot; 1 minute read
      </span>
      
      <p>I had fun speaking at <a href="http://qconlondon.com/">QCon</a> in London earlier this month with a talk on the Cloud track entitled the Perils of Portability.</p>

<p>This had some Governmenty stuff in but was mainly part rant, part hope for the future of cloud infrastructure. I had some great conversations with people afterwards who felt some of the similar pain which was nice to know. I also somehow managed to get 120 slides into a 40 minute presentation which I think is a personal records.</p>

<p><script async class="speakerdeck-embed" data-id="52f90c206ae90130747512313d140c86" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js">
</script>
The videos will be available at some point in the not too distant future too.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2013/02/17/going-fast-in-government/">Going fast in government</a>
      </h1>
      <span class="post-date">Feb 17, 2013 &middot; 1 minute read
      </span>
      
      <p>About a month ago I had the good fortune of speaking at the <a href="http://www.meetup.com/London-Web-Performance-Group/">London Web Performance</a> meetup. This was one of the first talks I&rsquo;ve done about our work at The Government Digital Service since the luanch of GOV.UK back in October. The topic was all about moving quickly in a large organisation (The UK Civil Service is about 450,000 people so I think it counts) and featured just a hand full of technical and organisational tricks we used.</p>

<script async class="speakerdeck-embed" data-id="bc48ed2042c20130b322123138156909" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js">
</script>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2013/02/17/march-madness/">March madness</a>
      </h1>
      <span class="post-date">Feb 17, 2013 &middot; 1 minute read
      </span>
      
      <p>With only a week or so to go before the end of February, it&rsquo;s looking like March might be a little busy.</p>

<ul>
<li>I&rsquo;m speaking at QCon, in London on Wednesday 6th on <a href="http://qconlondon.com/london-2013/presentation/Clouds%20in%20Government%20-%20Perils%20of%20Portability">Clouds in Government - Perils of Portability</a> (which in hindsight is probably the silliest title for a talk I&rsquo;ve ever used)</li>
<li>On the 15th and 16th of March I&rsquo;ll be at <a href="http://devopsdays.org/events/2013-london/">Devopsdays</a>, again in London. I&rsquo;ve been helping out with organising the event and I&rsquo;m very much looking forward to going along after seeing all the work being put in.</li>
<li>And last but not least I&rsquo;m heading to Boston for the rather exciting <a href="http://monitorama.com/">Monitorama</a> from the 26th until the 30th. Looking forward to meeting up in person with quite a few folks I&rsquo;ve spoken to over the last year or two.</li>
</ul>

<p>If you&rsquo;re going to be at any of these events (QCon and Devopsdays still have tickets available I think) then let me know.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2013/01/13/django-and-rails-presentation-from-qcon/">Django and Rails presentation from QCon</a>
      </h1>
      <span class="post-date">Jan 13, 2013 &middot; 1 minute read
      </span>
      
      <p>I had great fun back in November at the <a href="http://qconsf.com/">QCon</a> conference in San Francisco. As well as currating one of the tracks and catching up with people in the area I managed to give the following talk.</p>

<p><script async class="speakerdeck-embed" data-id="7e1dd5a03efc0130083b123139173def" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js">
</script>
In hindsight it might have been a bit odd to try and cover both Rails and Django examples in the one presentation but it was quite good fun putting together code examples using both of them at the same time. As well as a large set of tips, tricks and tools I settled on a few things that I think any web (or other) framework should support out of the box.</p>

<ul>
<li>A debug toolbar</li>
<li>Transparent caching support</li>
<li>Hooks for instrumentation</li>
<li>Configurable logging</li>
</ul>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2012/12/30/my-personal-package-repository/">my personal package repository</a>
      </h1>
      <span class="post-date">Dec 30, 2012 &middot; 2 minute read
      </span>
      
      <p>I&rsquo;m a <a href="http://www.morethanseven.net/2011/01/16/Why-developers-should-care-about-system-packages/">big fan of system packages for lots of reasons</a> and have often ended up rolling my own debian package repository at work, or working with others that have done so. Recently I finally got round to setting up a personal package repo, at <a href="http://packages.garethrushgrove.com">packages.garethrushgrove.com</a>. More interesting than the repo is probably the tool chain I used, oh and the rather nice bootstrap based styling.</p>

<p><img src="http://image-host.appspot.com/i/img?id=agppbWFnZS1ob3N0cg0LEgVJbWFnZRjh1wIM" alt="nice looking package repository"/></p>

<p>The source code for everything is <a href="https://github.com/garethr/packages">on GitHub</a> although not much documentation exists yet. In the middle are a few shell scripts that generate the repo. Around them is a Vagrant box (which makes it easier to build packages for different achitectures or distros) and some Rake commands</p>

<pre><code>&lt;code&gt;bundle exec rake -T
rake recipes:build[recipe]  # Build a package from one of the available recipes
rake recipes:list           # List available recipes
rake repo:build             # Build the repository&lt;/code&gt;
</code></pre>

<p>The recipes commands allow for building new packages based on scripts. A few examples are included which use fpm, but you could use anything. The repo:build command triggers the debian repository to be rebuilt.</p>

<p>The vagrant configuration shares various folders between and guest and host which also opens up a few useful features. One is I can just drop any old debian package into the debs folder and run the repo:build command and it will be in my repository. The other useful capability is that the resulting repo is shared back to the host, which means I can then check it into Git and in my case push it up to Heroku.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2012/12/03/on-the-forge/">On the forge</a>
      </h1>
      <span class="post-date">Dec 3, 2012 &middot; 3 minute read
      </span>
      
      

<p>I&rsquo;ve been spending a bit of time recently pushing a few Puppet modules to the <a href="http://forge.puppetlabs.com">Forge</a>. This is Puppetlabs attempt to make a central repository of reusable puppet modules. I started doing it as a bit of an experiment, to find out what I liked and what worked and I decided to writeup a few opinions.</p>

<p>So far I&rsquo;ve shipped the following modules:</p>

<ul>
<li><a href="http://forge.puppetlabs.com/garethr/riemann">Riemann</a></li>
<li><a href="http://forge.puppetlabs.com/garethr/graphite">Graphite</a></li>
<li><a href="http://forge.puppetlabs.com/garethr/logstash">Logstash</a></li>
<li><a href="http://forge.puppetlabs.com/garethr/freight">Freight</a></li>
</ul>

<p>Quite a few of these started as forks of other modules but have evolved quite a bit towards being more reusable.</p>

<p>I&rsquo;ve also started sending pull requests for modules that basically do what I want but don&rsquo;t always play well with others.</p>

<ul>
<li><a href="https://github.com/thomasvandoren/puppet-redis/pull/10">Redis</a></li>
</ul>

<h2 id="improved-tools">Improved tools</h2>

<p>It turns out the experience is mainly a pleasurable one, partly down to the much improved tooling around Puppet. Specifically I&rsquo;m making extensive use of:</p>

<ul>
<li><a href="http://rspec-puppet.com/">Rspec Puppet</a> - for writing tests for module behavious</li>
<li><a href="https://github.com/rodjek/librarian-puppet">Librarian Puppet</a> - dependency management for modules</li>
<li><a href="https://github.com/puppetlabs/puppetlabs_spec_helper">Puppet spec helper</a> - conventions and helpers for testing modules</li>
<li><a href="https://travis-ci.org/">Travis CI</a> - easy continuous integration for module code</li>
<li><a href="http://vagrantup.com/">Vagrant</a> - manage virtual machines, useful for smoke testing on different distributions</li>
</ul>

<p>Lots of those tools make testing Puppet modules both easier and useful. Here&rsquo;s an example of one of the above modules being tested. Note that it&rsquo;s run across Ruby 1.8.7, 1.9.2 and 1.9.3 and Puppet versions 2.7.17, 2.7.18 and 3.0.1 for a total of 9 builds. Handily the Redis module mentioned also had a test suite. The pull request includes changes to that, and Travis <a href="https://travis-ci.org/thomasvandoren/puppet-redis/builds/3462513">automatically tested the pull request</a> for the modules author.</p>

<h2 id="antipatterns">Antipatterns</h2>

<p>Using modules from the Forge really forces you to think about reusability. The pull request mentioned above for the Redis module for instance replaced an explicit mention of the build-essential package with the &ldquo;puppetlabs/gcc&rdquo;: class from the Forge. This makes the module less self contained, but without that change the module is incompatible with any other module that also uses that common package. I also went back and replaced explicit references to wget and build-essential in my Riemann module.</p>

<p>As a rule of thumb. For a specific module only include resources that are unique to the software the module manages. Anything else should be in another module with a dependency in the Modulefile.</p>

<p>This can feel a little much when you&rsquo;re replacing a simple Package resource with a whole new module but it has two advantages I care about. As well as the ability to use the module with other third party modules more easily it also makes it more likely that the module will work cross platform.</p>

<h2 id="what-s-missing">What&rsquo;s missing?</h2>

<p>I&rsquo;d like to see a few things improved when it comes to the Forge.</p>

<ul>
<li>I&rsquo;d like to be able to publish a new version of a module without having to use the web interface. The current workflow involves running a build command, then uploading the generated artifact via a web form after logging in.</li>
<li>I&rsquo;d like to see best practice module development guides front and centre on the Forge. Lots of modules won&rsquo;t work with other modules and I think that&rsquo;s fixable.</li>
<li>Integration with puppet-lint would be nice, giving some indication of whether the authors care about the Puppet styleguide.</li>
<li><del>A command line search interface would be useful</del>. And <a href="http://docs.puppetlabs.com/man/module.html">turns out to exist</a>. Thanks <a href="http://twitter.com/a1cy">@a1cy</a> for the heads up.</li>
<li>The Forge tracks number of downloads, but as a publisher I don&rsquo;t know how often my modules have been downloaded.</li>
<li>And finally I&rsquo;d like to see more people using it.</li>
</ul>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2012/10/21/shipping/">Shipping</a>
      </h1>
      <span class="post-date">Oct 21, 2012 &middot; 1 minute read
      </span>
      
      <p>Last week we shipped <a href="https://www.gov.uk">GOV.UK</a>. Over the last year we&rsquo;ve built a team to build a website. Now we&rsquo;re busy building a culture too. I&rsquo;ve got so much that needs writing up about everything we&rsquo;ve been up to. Hopefully I&rsquo;ll make a start in the next week or so.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2012/08/19/Tale-of-a-grok-pattern/">Tale Of A Grok Pattern</a>
      </h1>
      <span class="post-date">Aug 19, 2012 &middot; 3 minute read
      </span>
      
      

<p>I&rsquo;m all of a sudden adding lots more code to GitHub. Here&rsquo;s the latest project, <a href="https://github.com/garethr/logstash-patterns">grok patterns for logstash</a>. At the moment this repo only contains one new pattern but I&rsquo;m hoping to add more, and maybe even for others to add more too.</p>

<p>First, a bit of background. <a href="http://logstash.net/">Logstash</a> is the excellent, open source, log agregation and processing framework. It takes inputs from various configurable places, processes them with filters and then outputs the results. So maybe you&rsquo;ll take inputs from various application log files and output then into an elastic search index for easy searching, or output the same inputs to graphite and statsd to get graphs of rates. One of the host powerful filters in logstash is the <a href="http://logstash.net/docs/1.0.17/filters/grok">grok filter</a>. It takes a grok pattern and parses out information contained in the text into fields that can be more easily used by outputs. This post serves hopefully as both an explanation of why and an example of how you might do that.</p>

<h2 id="the-problem">The problem</h2>

<p>Rails logs are horrible, that is until you install the excellent <a href="https://github.com/roidrage/lograge">lograge</a> output formatter. That gives you lines like:</p>

<pre><code>GET /jobs/833552.json format=json action=jobs#show status=200 duration=58.33 view=40.43 db=15.26
</code></pre>

<p>This contains loads of useful information that&rsquo;s easily parsable by a developer. We have the HTTP status code, the rails controller and information about response time too. A grok filter lets us teach logstash about that information too. The working grok filter for filtering this line looks like this:</p>

<h2 id="the-solution">The solution</h2>

<pre><code>LOGRAGE %{WORD:method}%{SPACE}%{DATA}%{SPACE}action=%{WORD:controller}#%{WORD:action}%{SPACE}status=%{INT:status}%{SPACE}duration=%{NUMBER:duration}%{SPACE}view=%{NUMBER:view}(%{SPACE}db=%{NUMBER:db})?%{GREEDYDATA}
</code></pre>

<p>That was worked out pretty much with a bit of trial and error and use of the logstash java binary, using stdin and stdout inputs and outputs. It works but getting their wasn&rsquo;t that much funand proving it works outside a running logstash setup was tricky. Enter rspec and the grok implementation in pure Ruby. The project above contains an Rspec matcher for use when testing grok filters for logstash. I&rsquo;ll probably extract that into a gem at some point but you&rsquo;ll get the idea. Now we can write tests like these:</p>

<pre><code>the lograge grok pattern
  with a standard lograge log line
    should have the correct http method value
    should have the correct value for the request duration
    should have the correct value for the request view time
    should have the correct controller and action
    should have the correct value for db time
  without the db time
    should have the correct value for the request view time
  with a post request
    should have the correct http method value

Finished in 0.01472 seconds
7 examples, 0 failures
</code></pre>

<p>The <a href="https://github.com/garethr/logstash-patterns/blob/master/spec/lograge_spec.rb">tests themselves</a> are just basic Rspec with most of the work done in the <a href="https://github.com/garethr/logstash-patterns/blob/master/spec/spec_helper.rb">custom matcher</a>. This not only means I can be a bit more confident that my grok pattern works, it also provides a much nicer framework for writing more patterns for other log formats. Parsing rules like this are one area where test driven development is a huge boon in my experience. And with tests comes continuous integration, in this case via <a href="http://travis-ci.org/#!/garethr/logstash-patterns">Travis</a>.</p>

<p>I&rsquo;ll hopefully find myself writing more patterns and tests for them, and if anyone wants to send pull requests and to start collecting working grok patterns together so much the better.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2012/08/11/Riemann-puppet-module/">Riemann Puppet Module</a>
      </h1>
      <span class="post-date">Aug 11, 2012 &middot; 1 minute read
      </span>
      
      <p>Thanks to an <a href="https://twitter.com/bitprophet/status/233626675307479040">errant tweet</a> I started playing with <a href="http://aphyr.github.com/riemann/">Riemann</a> again. It ticks lots of boxes for me, from the clojure to configuration as code and the overloadable dashboard application. What started as using Puppet and Vagrant to investigate Riemann turned into a full blown tool and module writing exercise, resulting in two related projects on GitHub.</p>

<ul>
<li><a href="https://github.com/garethr/garethr-riemann/">garethr-riemann</a> is a Puppet module for installing and configuring Riemann. It allows for easily specifying your own server configuration and dashboard views.</li>
<li><a href="https://github.com/garethr/riemann-vagrant">riemann-vagrant</a> is a Vagrantfile and other code which uses above puppet module to setup a local testing environment.</li>
</ul>

<p>I like this combination, a separate Puppet module along with a vagrant powered test bed. I&rsquo;ve written a reasonable rspec based test suite to check the module but it&rsquo;s always easier to be able to run <em>vagrant provision</em> as well to check everything is working. This also turned out to be the perfect opportunity to use <a href="https://github.com/rodjek/librarian-puppet">Librarian-Puppet</a> to manage the dependencies and eventually to ship the module to the <a href="https://forge.puppetlabs.com/garethr/riemann">Puppet Forge</a>.</p>

      
    </div>
    
    <div class="post">
      <h1 class="post-title">
        <a href="/2012/07/01/The-vagrantbox.es-story/">The Vagrantbox.es Story</a>
      </h1>
      <span class="post-date">Jul 1, 2012 &middot; 2 minute read
      </span>
      
      <p>A few weeks ago now <a href="http://www.vagrantbox.es/">Vagrantbox.es</a> (a website I maintain for third party hosted <a href="http://vagrantup.com/">Vagrant</a> base boxes) dissapeared from the internet for a few days. This was completely my fault, the (lovely) hosting people <a href="https://www.ep.io/">ep.io</a> had unfortunately closed down the service they had in beta and I&rsquo;d been so busy that I hadn&rsquo;t had chance to move it elsewhere.</p>

<p>The original version of the site (I had the code and good backups of the data) was a pretty simple Django application, but I&rsquo;d used it to experiment (read over-engineer) with various bits of tech including Varnish, Solr, some ORM caching and lots more. This had been great, but it made it less portable. I had everything described in Puppet, but with virtually no spare time I decided to go a different route.</p>

<p>I threw a flat version of the site up on <a href="https://github.com/garethr/vagrantboxes-heroku">GitHub</a>, served it using Nginx on <a href="http://www.heroku.com/">Heroku</a> and added a quick <em>Fork me on GitHub</em> badge to the top. Suggest a box moved from being a web form to a pull request. It&rsquo;s fair to say I did this pretty quickly and made a good few typos on the way. But within a couple of weeks I&rsquo;ve had 8 pull requests either fixing my bugs, removing dead boxes and adding new ones.</p>

<p>What I&rsquo;m going to take from this is, if you&rsquo;re building a community project that&rsquo;s aimed at developers, then throw the content on GitHub. In my case I have the entire site on there too but I think that&rsquo;s secondary. Pull requests are much better than any content management system or workflow you&rsquo;re likely to build, and even more importantly the time to implement something drops hugely.</p>

<p>With all the spare time I don&rsquo;t have I&rsquo;ll be thinking about a content management model using GitHub for content, pull requests for workflow and post commit hooks for loading that content into a site or service somewhere.</p>

      
    </div>
    
    

<ul class="pagination">
    
    <li>
        <a href="/" aria-label="First"><span aria-hidden="true">&laquo;&laquo;</span></a>
    </li>
    
    <li
    >
    <a href="/page/4/" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a>
    </li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/">1</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/2/">2</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/3/">3</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/4/">4</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    class="active"><a href="/page/5/">5</a></li>
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/6/">6</a></li>
    
    
    
    
    
    
        
        
    
    
    <li class="disabled"><span aria-hidden="true">&hellip;</span></li>
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    
    
    
    
    
        
        
    
    
    <li
    ><a href="/page/43/">43</a></li>
    
    
    <li
    >
    <a href="/page/6/" aria-label="Next"><span aria-hidden="true">&raquo;</span></a>
    </li>
    
    <li>
        <a href="/page/43/" aria-label="Last"><span aria-hidden="true">&raquo;&raquo;</span></a>
    </li>
    
</ul>

  </div>
</div>



</body>
</html>

